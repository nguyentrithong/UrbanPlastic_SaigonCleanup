<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green City Vietnam - Sustainability Board Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .screen {
            display: none;
            width: 100%;
            max-width: 1200px;
            padding: 20px;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Menu Screen */
        .menu-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 60px 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            margin: 0 auto;
        }

        .game-title {
            font-size: 3em;
            color: #2d6a4f;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .game-subtitle {
            font-size: 1.2em;
            color: #52796f;
            margin-bottom: 30px;
        }

        .game-description {
            background: #d8f3dc;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            color: #1b4332;
            line-height: 1.6;
        }

        .btn {
            background: linear-gradient(135deg, #40916c 0%, #2d6a4f 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* Game Screen */
        .game-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #d8f3dc 0%, #b7e4c7 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-size: 0.9em;
            color: #1b4332;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2d6a4f;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(135deg, #95d5b2 0%, #74c69d 100%);
            border-radius: 15px;
        }

        .board-cell {
            aspect-ratio: 1;
            background: white;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 0.8em;
            padding: 10px;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .board-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .board-cell.player-position {
            background: linear-gradient(135deg, #ffd60a 0%, #ffc300 100%);
            border-color: #ff9500;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .cell-icon {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .cell-type {
            font-size: 0.7em;
            color: #1b4332;
            font-weight: bold;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        .dice {
            display: inline-block;
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 10px;
            font-size: 3em;
            line-height: 80px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin: 0 20px;
            transition: all 0.3s ease;
        }

        .dice.rolling {
            animation: roll 0.5s ease;
        }

        @keyframes roll {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
        }

        .card-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .card-modal.active {
            display: flex;
        }

        .card-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .card-title {
            font-size: 2em;
            color: #2d6a4f;
            margin-bottom: 20px;
        }

        .card-description {
            font-size: 1.1em;
            color: #333;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .card-choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .choice-btn {
            background: linear-gradient(135deg, #40916c 0%, #2d6a4f 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .choice-btn:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .turn-info {
            text-align: center;
            font-size: 1.2em;
            color: #2d6a4f;
            margin: 20px 0;
            font-weight: bold;
        }

        /* Results Screen */
        .results-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 60px 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            margin: 0 auto;
        }

        .results-title {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .results-title.win {
            color: #2d6a4f;
        }

        .results-title.lose {
            color: #d00000;
        }

        .results-stats {
            background: #d8f3dc;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .result-stat {
            font-size: 1.3em;
            margin: 15px 0;
            color: #1b4332;
        }

        .message {
            font-size: 1.1em;
            color: #333;
            line-height: 1.6;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .game-title {
                font-size: 2em;
            }
            
            .game-board {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .stat-value {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <!-- Menu Screen -->
    <div id="menuScreen" class="screen active">
        <div class="menu-container">
            <div class="game-title">üå± Green City Vietnam</div>
            <div class="game-subtitle">Build a Sustainable Future</div>
            
            <div class="game-description">
                <strong>M·ª•c ti√™u:</strong> X√¢y d·ª±ng th√†nh ph·ªë xanh b·ªÅn v·ªØng t·∫°i Vi·ªát Nam!<br><br>
                Di chuy·ªÉn tr√™n b·∫£ng, ƒë∆∞a ra quy·∫øt ƒë·ªãnh th√¥ng minh v·ªÅ nƒÉng l∆∞·ª£ng, giao th√¥ng v√† qu·∫£n l√Ω r√°c th·∫£i. 
                M·ªói l·ª±a ch·ªçn c·ªßa b·∫°n s·∫Ω ·∫£nh h∆∞·ªüng ƒë·∫øn l∆∞·ª£ng kh√≠ th·∫£i carbon v√† ƒëi·ªÉm ph√°t tri·ªÉn b·ªÅn v·ªØng.<br><br>
                <strong>üéØ Chi·∫øn th·∫Øng:</strong> ƒê·∫°t 100 ƒëi·ªÉm Sustainability v√† gi·∫£m Carbon xu·ªëng ‚â§ 20<br>
                <strong>‚ùå Th·∫•t b·∫°i:</strong> Carbon tƒÉng l√™n ‚â• 100 ho·∫∑c Budget xu·ªëng ‚â§ 0
            </div>
            
            <button class="btn" onclick="startGame()">üéÆ B·∫Øt ƒë·∫ßu ch∆°i</button>
            <button class="btn" onclick="showInstructions()">üìñ H∆∞·ªõng d·∫´n</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
        <div class="game-container">
            <h2 style="text-align: center; color: #2d6a4f; margin-bottom: 20px;">üå± Green City Vietnam</h2>
            
            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-label">üåç Carbon Score</div>
                    <div class="stat-value" id="carbonScore">50</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üíö Sustainability</div>
                    <div class="stat-value" id="sustainScore">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üí∞ Budget</div>
                    <div class="stat-value" id="budget">100</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üë• Happiness</div>
                    <div class="stat-value" id="happiness">50</div>
                </div>
            </div>

            <div class="turn-info">Turn <span id="turnNumber">1</span> / 15</div>

            <div class="game-board" id="gameBoard"></div>

            <div class="controls">
                <button class="btn" onclick="rollDice()" id="rollBtn">üé≤ Gieo x√∫c x·∫Øc</button>
                <div class="dice" id="diceDisplay">?</div>
                <button class="btn" onclick="backToMenu()">üè† Menu</button>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="resultsScreen" class="screen">
        <div class="results-container">
            <div class="results-title" id="resultsTitle">üéâ Chi·∫øn th·∫Øng!</div>
            
            <div class="results-stats">
                <div class="result-stat">üåç Carbon Score: <span id="finalCarbon">0</span></div>
                <div class="result-stat">üíö Sustainability: <span id="finalSustain">0</span></div>
                <div class="result-stat">üí∞ Budget: <span id="finalBudget">0</span></div>
                <div class="result-stat">üë• Happiness: <span id="finalHappiness">0</span></div>
            </div>

            <div class="message" id="resultsMessage"></div>

            <button class="btn" onclick="startGame()">üîÑ Ch∆°i l·∫°i</button>
            <button class="btn" onclick="backToMenu()">üè† Menu</button>
        </div>
    </div>

    <!-- Card Modal -->
    <div id="cardModal" class="card-modal">
        <div class="card-content">
            <div class="card-title" id="cardTitle"></div>
            <div class="card-description" id="cardDescription"></div>
            <div class="card-choices" id="cardChoices"></div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            carbon: 50,
            sustainability: 0,
            budget: 100,
            happiness: 50,
            position: 0,
            turn: 1,
            maxTurns: 15
        };

        // Board cells configuration
        const boardCells = [
            { type: 'start', icon: 'üè†', name: 'Start' },
            { type: 'decision', icon: '‚ö°', name: 'Energy' },
            { type: 'event', icon: 'üåä', name: 'Event' },
            { type: 'decision', icon: 'üöá', name: 'Transport' },
            { type: 'resource', icon: 'üí∞', name: 'Funding' },
            { type: 'decision', icon: '‚ôªÔ∏è', name: 'Waste' },
            { type: 'event', icon: 'üå≥', name: 'Event' },
            { type: 'challenge', icon: '‚ö†Ô∏è', name: 'Challenge' },
            { type: 'decision', icon: 'üè≠', name: 'Industry' },
            { type: 'bonus', icon: '‚≠ê', name: 'Bonus' },
            { type: 'decision', icon: 'üåæ', name: 'Agriculture' },
            { type: 'event', icon: 'üå°Ô∏è', name: 'Event' },
            { type: 'decision', icon: 'üè¢', name: 'Building' },
            { type: 'resource', icon: 'üí∞', name: 'Funding' },
            { type: 'decision', icon: 'üå≤', name: 'Forest' },
            { type: 'event', icon: '‚òÄÔ∏è', name: 'Event' },
            { type: 'challenge', icon: '‚ö†Ô∏è', name: 'Challenge' },
            { type: 'decision', icon: 'üíß', name: 'Water' },
            { type: 'bonus', icon: '‚≠ê', name: 'Bonus' },
            { type: 'finish', icon: 'üèÜ', name: 'Finish' }
        ];

        // Decision scenarios
        const scenarios = {
            energy: [
                {
                    title: '‚ö° Ngu·ªìn nƒÉng l∆∞·ª£ng cho th√†nh ph·ªë',
                    description: 'Th√†nh ph·ªë c·∫ßn th√™m nƒÉng l∆∞·ª£ng. B·∫°n ch·ªçn ngu·ªìn n√†o?',
                    choices: [
                        { text: '‚òÄÔ∏è NƒÉng l∆∞·ª£ng m·∫∑t tr·ªùi (-15 Budget, -10 Carbon, +15 Sustain)', effects: { budget: -15, carbon: -10, sustainability: 15, happiness: 5 } },
                        { text: 'üè≠ Nh√† m√°y nhi·ªát ƒëi·ªán (-5 Budget, +15 Carbon, -5 Sustain)', effects: { budget: -5, carbon: 15, sustainability: -5, happiness: -10 } },
                        { text: 'üí® NƒÉng l∆∞·ª£ng gi√≥ (-20 Budget, -12 Carbon, +18 Sustain)', effects: { budget: -20, carbon: -12, sustainability: 18, happiness: 8 } }
                    ]
                }
            ],
            transport: [
                {
                    title: 'üöá Giao th√¥ng ƒë√¥ th·ªã',
                    description: 'Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ k·∫πt xe v√† √¥ nhi·ªÖm kh√¥ng kh√≠?',
                    choices: [
                        { text: 'üöá X√¢y d·ª±ng t√†u ƒëi·ªán ng·∫ßm (-25 Budget, -15 Carbon, +20 Sustain)', effects: { budget: -25, carbon: -15, sustainability: 20, happiness: 15 } },
                        { text: 'üöå TƒÉng xe bus c√¥ng c·ªông (-10 Budget, -8 Carbon, +12 Sustain)', effects: { budget: -10, carbon: -8, sustainability: 12, happiness: 8 } },
                        { text: 'üõ£Ô∏è M·ªü r·ªông ƒë∆∞·ªùng xe m√°y (-8 Budget, +12 Carbon, -8 Sustain)', effects: { budget: -8, carbon: 12, sustainability: -8, happiness: -5 } }
                    ]
                }
            ],
            waste: [
                {
                    title: '‚ôªÔ∏è Qu·∫£n l√Ω r√°c th·∫£i',
                    description: 'R√°c th·∫£i nh·ª±a ƒëang tr√†n lan. Gi·∫£i ph√°p c·ªßa b·∫°n?',
                    choices: [
                        { text: '‚ôªÔ∏è Ch∆∞∆°ng tr√¨nh t√°i ch·∫ø to√†n di·ªán (-18 Budget, -12 Carbon, +16 Sustain)', effects: { budget: -18, carbon: -12, sustainability: 16, happiness: 12 } },
                        { text: 'üöØ C·∫•m t√∫i nilon v√† ƒë·ªì nh·ª±a 1 l·∫ßn (-10 Budget, -8 Carbon, +14 Sustain)', effects: { budget: -10, carbon: -8, sustainability: 14, happiness: 5 } },
                        { text: 'üóëÔ∏è X√¢y b√£i ch√¥n l·∫•p m·ªõi (-5 Budget, +10 Carbon, -5 Sustain)', effects: { budget: -5, carbon: 10, sustainability: -5, happiness: -8 } }
                    ]
                }
            ],
            industry: [
                {
                    title: 'üè≠ Ph√°t tri·ªÉn c√¥ng nghi·ªáp',
                    description: 'M·ªôt c√¥ng ty mu·ªën m·ªü nh√† m√°y t·∫°i th√†nh ph·ªë c·ªßa b·∫°n.',
                    choices: [
                        { text: 'üå± Ch·ªâ ch·∫•p nh·∫≠n c√¥ng nghi·ªáp xanh (+10 Budget, -5 Carbon, +10 Sustain)', effects: { budget: 10, carbon: -5, sustainability: 10, happiness: 8 } },
                        { text: '‚öñÔ∏è Ch·∫•p nh·∫≠n v·ªõi ƒëi·ªÅu ki·ªán m√¥i tr∆∞·ªùng (+15 Budget, +5 Carbon, +5 Sustain)', effects: { budget: 15, carbon: 5, sustainability: 5, happiness: 5 } },
                        { text: 'üí∞ Ch·∫•p nh·∫≠n m·ªçi c√¥ng ty (+25 Budget, +20 Carbon, -12 Sustain)', effects: { budget: 25, carbon: 20, sustainability: -12, happiness: -10 } }
                    ]
                }
            ],
            agriculture: [
                {
                    title: 'üåæ N√¥ng nghi·ªáp b·ªÅn v·ªØng',
                    description: 'N√¥ng d√¢n ƒëang s·ª≠ d·ª•ng qu√° nhi·ªÅu ph√¢n b√≥n h√≥a h·ªçc.',
                    choices: [
                        { text: 'üå± Khuy·∫øn kh√≠ch n√¥ng nghi·ªáp h·ªØu c∆° (-15 Budget, -10 Carbon, +15 Sustain)', effects: { budget: -15, carbon: -10, sustainability: 15, happiness: 10 } },
                        { text: 'üìö ƒê√†o t·∫°o k·ªπ thu·∫≠t canh t√°c xanh (-10 Budget, -6 Carbon, +10 Sustain)', effects: { budget: -10, carbon: -6, sustainability: 10, happiness: 8 } },
                        { text: 'ü§∑ Gi·ªØ nguy√™n hi·ªán tr·∫°ng (0 Budget, +8 Carbon, -5 Sustain)', effects: { budget: 0, carbon: 8, sustainability: -5, happiness: -5 } }
                    ]
                }
            ],
            building: [
                {
                    title: 'üè¢ X√¢y d·ª±ng xanh',
                    description: 'Th√†nh ph·ªë c·∫ßn th√™m nh√† ·ªü. Ti√™u chu·∫©n x√¢y d·ª±ng?',
                    choices: [
                        { text: 'üåø T√≤a nh√† xanh LEED (-20 Budget, -10 Carbon, +18 Sustain)', effects: { budget: -20, carbon: -10, sustainability: 18, happiness: 12 } },
                        { text: '‚òÄÔ∏è T√≤a nh√† ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng (-12 Budget, -6 Carbon, +10 Sustain)', effects: { budget: -12, carbon: -6, sustainability: 10, happiness: 8 } },
                        { text: 'üèóÔ∏è X√¢y d·ª±ng th√¥ng th∆∞·ªùng (-5 Budget, +8 Carbon, -5 Sustain)', effects: { budget: -5, carbon: 8, sustainability: -5, happiness: 0 } }
                    ]
                }
            ],
            forest: [
                {
                    title: 'üå≤ B·∫£o v·ªá r·ª´ng',
                    description: 'R·ª´ng xung quanh th√†nh ph·ªë ƒëang b·ªã ch·∫∑t ph√°.',
                    choices: [
                        { text: 'üå≥ Tr·ªìng r·ª´ng quy m√¥ l·ªõn (-22 Budget, -18 Carbon, +22 Sustain)', effects: { budget: -22, carbon: -18, sustainability: 22, happiness: 15 } },
                        { text: 'üö´ C·∫•m ch·∫∑t ph√° r·ª´ng (-12 Budget, -10 Carbon, +12 Sustain)', effects: { budget: -12, carbon: -10, sustainability: 12, happiness: 8 } },
                        { text: 'üí∞ Cho ph√©p khai th√°c c√≥ ki·ªÉm so√°t (+10 Budget, +10 Carbon, -8 Sustain)', effects: { budget: 10, carbon: 10, sustainability: -8, happiness: -5 } }
                    ]
                }
            ],
            water: [
                {
                    title: 'üíß Qu·∫£n l√Ω n∆∞·ªõc',
                    description: 'Ngu·ªìn n∆∞·ªõc s·∫°ch ƒëang c·∫°n ki·ªát v√† √¥ nhi·ªÖm.',
                    choices: [
                        { text: 'üèûÔ∏è X√¢y h·ªá th·ªëng x·ª≠ l√Ω n∆∞·ªõc hi·ªán ƒë·∫°i (-18 Budget, -8 Carbon, +15 Sustain)', effects: { budget: -18, carbon: -8, sustainability: 15, happiness: 12 } },
                        { text: 'üíß Thu gom n∆∞·ªõc m∆∞a (-10 Budget, -5 Carbon, +10 Sustain)', effects: { budget: -10, carbon: -5, sustainability: 10, happiness: 8 } },
                        { text: 'ü§∑ Ti·∫øp t·ª•c d√πng ngu·ªìn hi·ªán t·∫°i (0 Budget, +5 Carbon, -8 Sustain)', effects: { budget: 0, carbon: 5, sustainability: -8, happiness: -10 } }
                    ]
                }
            ]
        };

        const events = [
            {
                title: 'üåä L≈© l·ª•t ƒë·ªôt ng·ªôt',
                description: 'M∆∞a l·ªõn g√¢y ng·∫≠p l·ª•t do h·ªá th·ªëng tho√°t n∆∞·ªõc k√©m.',
                effect: { carbon: 5, sustainability: -8, budget: -15, happiness: -10 }
            },
            {
                title: 'üå≥ T·ªï ch·ª©c phi ch√≠nh ph·ªß h·ªó tr·ª£',
                description: 'M·ªôt NGO qu·ªëc t·∫ø mu·ªën t√†i tr·ª£ d·ª± √°n m√¥i tr∆∞·ªùng.',
                effect: { carbon: -5, sustainability: 10, budget: 20, happiness: 8 }
            },
            {
                title: 'üå°Ô∏è N·∫Øng n√≥ng k·ª∑ l·ª•c',
                description: 'Nhi·ªát ƒë·ªô tƒÉng cao, nhu c·∫ßu ƒëi·ªán tƒÉng ƒë·ªôt bi·∫øn.',
                effect: { carbon: 8, sustainability: -5, budget: -10, happiness: -8 }
            },
            {
                title: '‚òÄÔ∏è C√¥ng ngh·ªá m·ªõi',
                description: 'Ph√°t minh c√¥ng ngh·ªá nƒÉng l∆∞·ª£ng m·∫∑t tr·ªùi hi·ªáu qu·∫£ h∆°n!',
                effect: { carbon: -10, sustainability: 15, budget: 10, happiness: 12 }
            }
        ];

        const challenges = [
            {
                title: '‚ö†Ô∏è Bi·ªÉu t√¨nh m√¥i tr∆∞·ªùng',
                description: 'Ng∆∞·ªùi d√¢n y√™u c·∫ßu h√†nh ƒë·ªông m·∫°nh m·∫Ω h∆°n v·ªÅ kh√≠ h·∫≠u.',
                effect: { sustainability: 5, happiness: -15 }
            },
            {
                title: '‚ö†Ô∏è Kh·ªßng ho·∫£ng ng√¢n s√°ch',
                description: 'Ng√¢n s√°ch th√†nh ph·ªë b·ªã c·∫Øt gi·∫£m do kh·ªßng ho·∫£ng kinh t·∫ø.',
                effect: { budget: -20, happiness: -10 }
            }
        ];

        function initGame() {
            createBoard();
            updateStats();
            updateBoard();
        }

        function createBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            boardCells.forEach((cell, index) => {
                const cellDiv = document.createElement('div');
                cellDiv.className = 'board-cell';
                cellDiv.id = `cell-${index}`;
                cellDiv.innerHTML = `
                    <div class="cell-icon">${cell.icon}</div>
                    <div class="cell-type">${cell.name}</div>
                `;
                board.appendChild(cellDiv);
            });
        }

        function updateBoard() {
            document.querySelectorAll('.board-cell').forEach((cell, index) => {
                cell.classList.remove('player-position');
                if (index === gameState.position) {
                    cell.classList.add('player-position');
                }
            });
        }

        function updateStats() {
            document.getElementById('carbonScore').textContent = gameState.carbon;
            document.getElementById('sustainScore').textContent = gameState.sustainability;
            document.getElementById('budget').textContent = gameState.budget;
            document.getElementById('happiness').textContent = gameState.happiness;
            document.getElementById('turnNumber').textContent = gameState.turn;
        }

        function rollDice() {
            const rollBtn = document.getElementById('rollBtn');
            rollBtn.disabled = true;
            
            const dice = document.getElementById('diceDisplay');
            dice.classList.add('rolling');
            
            setTimeout(() => {
                const roll = Math.floor(Math.random() * 6) + 1;
                dice.textContent = roll;
                dice.classList.remove('rolling');
                
                movePlayer(roll);
                rollBtn.disabled = false;
            }, 500);
        }

        function movePlayer(steps) {
            gameState.position += steps;
            if (gameState.position >= boardCells.length) {
                gameState.position = boardCells.length - 1;
            }
            
            updateBoard();
            
            setTimeout(() => {
                handleCell();
            }, 300);
        }

        function handleCell() {
            const cell = boardCells[gameState.position];
            
            switch(cell.type) {
                case 'decision':
                    showDecision(cell.name.toLowerCase());
                    break;
                case 'event':
                    showEvent();
                    break;
                case 'challenge':
                    showChallenge();
                    break;
                case 'resource':
                    applyEffect({ budget: 20, sustainability: 5 });
                    showNotification('üí∞ Nh·∫≠n ƒë∆∞·ª£c t√†i tr·ª£! +20 Budget, +5 Sustainability');
                    nextTurn();
                    break;
                case 'bonus':
                    applyEffect({ carbon: -10, sustainability: 10, happiness: 10 });
                    showNotification('‚≠ê √î may m·∫Øn! -10 Carbon, +10 Sustainability, +10 Happiness');
                    nextTurn();
                    break;
                case 'finish':
                    checkWinCondition();
                    break;
                default:
                    nextTurn();
            }
        }

        function showDecision(type) {
            const scenarioList = scenarios[type] || scenarios.energy;
            const scenario = scenarioList[Math.floor(Math.random() * scenarioList.length)];
            
            document.getElementById('cardTitle').textContent = scenario.title;
            document.getElementById('cardDescription').textContent = scenario.description;
            
            const choicesDiv = document.getElementById('cardChoices');
            choicesDiv.innerHTML = '';
            
            scenario.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = choice.text;
                btn.onclick = () => makeChoice(choice.effects);
                choicesDiv.appendChild(btn);
            });
            
            document.getElementById('cardModal').classList.add('active');
        }

        function showEvent() {
            const event = events[Math.floor(Math.random() * events.length)];
            
            document.getElementById('cardTitle').textContent = event.title;
            document.getElementById('cardDescription').textContent = event.description;
            
            const choicesDiv = document.getElementById('cardChoices');
            choicesDiv.innerHTML = '';
            
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.textContent = '‚úì Ti·∫øp t·ª•c';
            btn.onclick = () => {
                applyEffect(event.effect);
                closeModal();
                nextTurn();
            };
            choicesDiv.appendChild(btn);
            
            document.getElementById('cardModal').classList.add('active');
        }

        function showChallenge() {
            const challenge = challenges[Math.floor(Math.random() * challenges.length)];
            
            document.getElementById('cardTitle').textContent = challenge.title;
            document.getElementById('cardDescription').textContent = challenge.description;
            
            const choicesDiv = document.getElementById('cardChoices');
            choicesDiv.innerHTML = '';
            
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.textContent = '‚úì Ch·∫•p nh·∫≠n';
            btn.onclick = () => {
                applyEffect(challenge.effect);
                closeModal();
                nextTurn();
            };
            choicesDiv.appendChild(btn);
            
            document.getElementById('cardModal').classList.add('active');
        }

        function makeChoice(effects) {
            applyEffect(effects);
            closeModal();
            nextTurn();
        }

        function applyEffect(effects) {
            if (effects.carbon) gameState.carbon += effects.carbon;
            if (effects.sustainability) gameState.sustainability += effects.sustainability;
            if (effects.budget) gameState.budget += effects.budget;
            if (effects.happiness) gameState.happiness += effects.happiness;
            
            // Keep values in reasonable ranges
            gameState.carbon = Math.max(0, Math.min(150, gameState.carbon));
            gameState.sustainability = Math.max(0, Math.min(150, gameState.sustainability));
            gameState.budget = Math.max(-50, Math.min(200, gameState.budget));
            gameState.happiness = Math.max(0, Math.min(100, gameState.happiness));
            
            updateStats();
        }

        function closeModal() {
            document.getElementById('cardModal').classList.remove('active');
        }

        function nextTurn() {
            gameState.turn++;
            updateStats();
            
            checkGameOver();
        }

        function checkGameOver() {
            // Win conditions
            if (gameState.sustainability >= 100 && gameState.carbon <= 20) {
                showResults(true, 'perfect');
                return;
            }
            
            // Lose conditions
            if (gameState.carbon >= 100) {
                showResults(false, 'carbon');
                return;
            }
            
            if (gameState.budget <= 0) {
                showResults(false, 'budget');
                return;
            }
            
            // Turn limit
            if (gameState.turn > gameState.maxTurns) {
                checkFinalScore();
                return;
            }
        }

        function checkWinCondition() {
            checkFinalScore();
        }

        function checkFinalScore() {
            if (gameState.sustainability >= 100 && gameState.carbon <= 20) {
                showResults(true, 'perfect');
            } else if (gameState.sustainability >= 70 && gameState.carbon <= 40) {
                showResults(true, 'good');
            } else if (gameState.sustainability >= 50) {
                showResults(true, 'ok');
            } else {
                showResults(false, 'failed');
            }
        }

        function showResults(win, reason) {
            const resultsTitle = document.getElementById('resultsTitle');
            const resultsMessage = document.getElementById('resultsMessage');
            
            document.getElementById('finalCarbon').textContent = gameState.carbon;
            document.getElementById('finalSustain').textContent = gameState.sustainability;
            document.getElementById('finalBudget').textContent = gameState.budget;
            document.getElementById('finalHappiness').textContent = gameState.happiness;
            
            if (win) {
                resultsTitle.textContent = 'üéâ Chi·∫øn th·∫Øng!';
                resultsTitle.className = 'results-title win';
                
                if (reason === 'perfect') {
                    resultsMessage.textContent = 'Xu·∫•t s·∫Øc! B·∫°n ƒë√£ x√¢y d·ª±ng m·ªôt th√†nh ph·ªë xanh ho√†n h·∫£o v·ªõi carbon th·∫•p v√† ph√°t tri·ªÉn b·ªÅn v·ªØng cao. Vi·ªát Nam t·ª± h√†o v·ªÅ th√†nh ph·ªë c·ªßa b·∫°n!';
                } else if (reason === 'good') {
                    resultsMessage.textContent = 'L√†m t·ªët l·∫Øm! Th√†nh ph·ªë c·ªßa b·∫°n ƒëang tr√™n ƒë√† ph√°t tri·ªÉn b·ªÅn v·ªØng. Ti·∫øp t·ª•c n·ªó l·ª±c ƒë·ªÉ ƒë·∫°t m·ª•c ti√™u net-zero carbon!';
                } else {
                    resultsMessage.textContent = 'Kh√¥ng t·ªá! Th√†nh ph·ªë c√≥ m·ªôt s·ªë ti·∫øn b·ªô v·ªÅ b·ªÅn v·ªØng, nh∆∞ng v·∫´n c·∫ßn c·∫£i thi·ªán th√™m ƒë·ªÉ ƒë·ªëi ph√≥ v·ªõi bi·∫øn ƒë·ªïi kh√≠ h·∫≠u.';
                }
            } else {
                resultsTitle.textContent = 'üòî Th·∫•t b·∫°i';
                resultsTitle.className = 'results-title lose';
                
                if (reason === 'carbon') {
                    resultsMessage.textContent = 'L∆∞·ª£ng kh√≠ th·∫£i carbon qu√° cao! Th√†nh ph·ªë c·ªßa b·∫°n ƒëang g√≥p ph·∫ßn l√†m tƒÉng hi·ªáu ·ª©ng nh√† k√≠nh. H√£y ∆∞u ti√™n nƒÉng l∆∞·ª£ng s·∫°ch v√† gi·∫£m ph√°t th·∫£i h∆°n.';
                } else if (reason === 'budget') {
                    resultsMessage.textContent = 'Ng√¢n s√°ch c·∫°n ki·ªát! Th√†nh ph·ªë kh√¥ng c√≤n ti·ªÅn ƒë·ªÉ th·ª±c hi·ªán c√°c d·ª± √°n. C·∫ßn c√¢n b·∫±ng t·ªët h∆°n gi·ªØa ƒë·∫ßu t∆∞ v√† chi ti√™u.';
                } else {
                    resultsMessage.textContent = 'Th√†nh ph·ªë ch∆∞a ƒë·∫°t m·ª•c ti√™u ph√°t tri·ªÉn b·ªÅn v·ªØng. Bi·∫øn ƒë·ªïi kh√≠ h·∫≠u v·∫´n l√† th√°ch th·ª©c l·ªõn. H√£y th·ª≠ l·∫°i v·ªõi chi·∫øn l∆∞·ª£c kh√°c!';
                }
            }
            
            showScreen('resultsScreen');
        }

        function showNotification(message) {
            // Simple notification (could be enhanced with a toast/popup)
            setTimeout(() => {
                alert(message);
            }, 300);
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function startGame() {
            // Reset game state
            gameState = {
                carbon: 50,
                sustainability: 0,
                budget: 100,
                happiness: 50,
                position: 0,
                turn: 1,
                maxTurns: 15
            };
            
            initGame();
            showScreen('gameScreen');
        }

        function backToMenu() {
            showScreen('menuScreen');
        }

        function showInstructions() {
            alert('üìñ H∆Ø·ªöNG D·∫™N CH∆†I\n\n' +
                  '1. Gieo x√∫c x·∫Øc ƒë·ªÉ di chuy·ªÉn tr√™n b·∫£ng\n' +
                  '2. M·ªói √¥ c√≥ c√°c s·ª± ki·ªán kh√°c nhau:\n' +
                  '   ‚Ä¢ Decision: ƒê∆∞a ra quy·∫øt ƒë·ªãnh quan tr·ªçng\n' +
                  '   ‚Ä¢ Event: S·ª± ki·ªán ng·∫´u nhi√™n x·∫£y ra\n' +
                  '   ‚Ä¢ Challenge: Th·ª≠ th√°ch c·∫ßn v∆∞·ª£t qua\n' +
                  '   ‚Ä¢ Resource: Nh·∫≠n t√†i nguy√™n\n' +
                  '   ‚Ä¢ Bonus: Ph·∫ßn th∆∞·ªüng may m·∫Øn\n\n' +
                  '3. Theo d√µi 4 ch·ªâ s·ªë:\n' +
                  '   üåç Carbon: Gi·ªØ th·∫•p (m·ª•c ti√™u ‚â§20)\n' +
                  '   üíö Sustainability: TƒÉng cao (m·ª•c ti√™u ‚â•100)\n' +
                  '   üí∞ Budget: ƒê·ª´ng ƒë·ªÉ c·∫°n ki·ªát\n' +
                  '   üë• Happiness: Gi·ªØ ng∆∞·ªùi d√¢n h·∫°nh ph√∫c\n\n' +
                  'üéØ CHI·∫æN TH·∫ÆNG: ƒê·∫°t 100 Sustainability v√† Carbon ‚â§20\n' +
                  '‚ùå TH·∫§T B·∫†I: Carbon ‚â•100 ho·∫∑c Budget ‚â§0\n\n' +
                  'Ch√∫c may m·∫Øn! üå±');
        }

        // Initialize on load
        window.onload = function() {
            // Nothing to initialize yet, game starts from menu
        };
    </script>

<style>
/* --- Help Modal (accessible) --- */
.help-backdrop{position:fixed;inset:0;background:rgba(6,10,20,.6);backdrop-filter:saturate(120%) blur(2px);
  display:none;align-items:center;justify-content:center;z-index:9999;}
.help-backdrop.show{display:flex;}
.help-dialog{width:min(720px,92vw);max-height:86vh;overflow:auto;border-radius:16px;
  box-shadow:0 20px 60px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.06);
  background:linear-gradient(180deg,#0f1730,#111c3a); color:#e6eeff; border:1px solid #24345c;}
.help-header{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;border-bottom:1px solid #223355}
.help-title{margin:0;font-size:20px}
.help-close{appearance:none;border:0;border-radius:10px;background:#1a2b52;color:#cfe3ff;padding:8px 12px;cursor:pointer}
.help-body{padding:18px;font-size:15px;line-height:1.55}
.help-body .grid{display:grid;gap:10px}
.help-body .tip{background:#0f2044;border:1px solid #23407a;padding:10px;border-radius:10px}
.help-footer{display:flex;justify-content:flex-end;padding:12px 18px;border-top:1px solid #223355}
.help-ok{appearance:none;border:0;border-radius:10px;background:#52b4ff;color:#082039;font-weight:700;padding:10px 14px;cursor:pointer}
kbd{background:#102542;border:1px solid #1f3b6c;border-radius:6px;padding:2px 6px;font-family:ui-monospace,Consolas,monospace;font-size:12px}
</style>

<div class="help-backdrop" id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpTitle" aria-hidden="true">
  <div class="help-dialog">
    <div class="help-header">
      <h3 id="helpTitle" class="help-title">üìò H∆Ø·ªöNG D·∫™N CH∆†I</h3>
      <button class="help-close" type="button" aria-label="ƒê√≥ng h∆∞·ªõng d·∫´n">‚úï</button>
    </div>
    <div class="help-body">
      <div class="grid">
        <div class="tip"><strong>üé≤ B∆∞·ªõc 1:</strong> Gieo x√∫c x·∫Øc v√† di chuy·ªÉn tr√™n b·∫£ng.</div>
        <div class="tip"><strong>üéØ B∆∞·ªõc 2:</strong> ·ªû m·ªói √¥ b·∫°n g·∫∑p <em>Decision / Event / Challenge / Resource</em> ‚Äî h√£y ƒë·ªçc k·ªπ v√† ch·ªçn.</div>
        <div class="tip"><strong>üìà B∆∞·ªõc 3:</strong> Ch·ªâ s·ªë s·∫Ω thay ƒë·ªïi (Budget / Sustainability / Carbon...). C√¢n b·∫±ng ƒë·ªÉ kh√¥ng r∆°i v√†o tr·∫°ng th√°i thua.</div>
      </div>
      <hr style="border:0;border-top:1px solid #223355;margin:14px 0;">
      <p><strong>üèÜ Chi·∫øn th·∫Øng:</strong> ƒê·∫°t m·ª•c ti√™u ƒë·ªÅ ra (v√≠ d·ª•: Sustainability ‚â• 100 &amp; Carbon ‚â§ 20).</p>
      <p><strong>‚ùå Th·∫•t b·∫°i:</strong> Carbon ‚â• 100 ho·∫∑c Budget ‚â§ 0.</p>
      <p><strong>‚å®Ô∏è M·∫πo:</strong> B·∫°n c√≥ th·ªÉ d√πng <kbd>Space</kbd> ƒë·ªÉ b·ªè qua th√¥ng b√°o, <kbd>Esc</kbd> ƒë·ªÉ ƒë√≥ng h·ªôp tho·∫°i.</p>
    </div>
    <div class="help-footer">
      <button class="help-ok" type="button">OK</button>
    </div>
  </div>
</div>

<script>
(function(){
  const modal = document.getElementById('helpModal');
  if(!modal) return;
  const openers = [];
  [['[data-action="help"]'], ['#help','#helpBtn'], ['.btn-help'], ['button']].forEach(selArr=>{
    selArr.forEach(sel=> document.querySelectorAll(sel).forEach(el=>openers.push(el)));
  });
  function textHas(el, words){ return words.some(w => (el.textContent||'').toLowerCase().includes(w)); }
  const words = ['h∆∞·ªõng d·∫´n','help'];
  for(const el of openers){
    if(el.matches('[data-action="help"],#help,#helpBtn,.btn-help') || textHas(el, words)){
      el.addEventListener('click', e => { e.preventDefault(); showModal(); });
    }
  }
  const btnClose = modal.querySelector('.help-close');
  const btnOk = modal.querySelector('.help-ok');
  function showModal(){
    modal.classList.add('show');
    modal.removeAttribute('aria-hidden');
    setTimeout(()=> (btnOk && btnOk.focus()), 0);
  }
  function hideModal(){
    modal.classList.remove('show');
    modal.setAttribute('aria-hidden','true');
  }
  btnClose && btnClose.addEventListener('click', hideModal);
  btnOk && btnOk.addEventListener('click', hideModal);
  modal.addEventListener('click', (e)=>{ if(e.target===modal) hideModal(); });
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.classList.contains('show')) hideModal(); });
})();
</script>
</body>
</html>